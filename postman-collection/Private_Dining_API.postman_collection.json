{
  "info": {
    "_postman_id": "private-dining-api-v2",
    "name": "Private Dining API v2",
    "description": "Complete API test suite - all data fetched dynamically. Run tests in sequence using Collection Runner.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {"key": "baseUrl", "value": "http://localhost:8080/api/v1"},
    {"key": "healthUrl", "value": "http://localhost:8080/actuator/health"},
    {"key": "restaurantId", "value": ""},
    {"key": "spaceId", "value": ""},
    {"key": "maxCapacity", "value": ""},
    {"key": "minCapacity", "value": ""},
    {"key": "slotDuration", "value": ""},
    {"key": "openTime", "value": "09:00"},
    {"key": "closeTime", "value": "22:00"},
    {"key": "testDate", "value": ""},
    {"key": "testDate2", "value": ""},
    {"key": "availableStartTime", "value": ""},
    {"key": "availableEndTime", "value": ""},
    {"key": "reservationId", "value": ""},
    {"key": "reservationId2", "value": ""},
    {"key": "reservationId3", "value": ""},
    {"key": "capacityAfterBooking", "value": ""},
    {"key": "bookedCapacityBeforeDelete", "value": ""},
    {"key": "firstBookingStartTime", "value": ""},
    {"key": "slotEndTime", "value": ""}
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Collection-level pre-request script",
          "// Calculate a valid future date that should be open (Tue-Sat)",
          "// Always recalculate to ensure fresh date",
          "var d = new Date();",
          "d.setDate(d.getDate() + 1);",
          "// Skip Sunday (0) and Monday (1) - these are commonly closed",
          "while (d.getDay() === 0 || d.getDay() === 1) {",
          "    d.setDate(d.getDate() + 1);",
          "}",
          "var calculatedDate = d.toISOString().split('T')[0];",
          "// Only set if not already set by test 1.2",
          "if (!pm.collectionVariables.get('testDate')) {",
          "    pm.collectionVariables.set('testDate', calculatedDate);",
          "}"
        ]
      }
    }
  ],
  "item": [
    {
      "name": "1. Setup & Health Check",
      "item": [
        {
          "name": "1.1 Health Check",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('API is healthy', function() {",
                  "    pm.response.to.have.status(200);",
                  "    var json = pm.response.json();",
                  "    pm.expect(json.status).to.eql('UP');",
                  "});",
                  "",
                  "pm.test('MongoDB is connected', function() {",
                  "    var json = pm.response.json();",
                  "    pm.expect(json.components.mongo.status).to.eql('UP');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{healthUrl}}",
              "host": ["{{healthUrl}}"]
            }
          }
        },
        {
          "name": "1.2 List Restaurants & Set Variables",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Got restaurants list', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var data = pm.response.json();",
                  "",
                  "pm.test('Response has content array', function() {",
                  "    pm.expect(data.content).to.be.an('array');",
                  "    pm.expect(data.content.length).to.be.greaterThan(0);",
                  "});",
                  "",
                  "var restaurant = data.content[0];",
                  "",
                  "pm.test('Restaurant has required fields', function() {",
                  "    pm.expect(restaurant.id).to.exist;",
                  "    pm.expect(restaurant.name).to.exist;",
                  "    pm.expect(restaurant.spaces).to.be.an('array');",
                  "});",
                  "",
                  "pm.test('Restaurant ID is valid MongoDB ObjectId', function() {",
                  "    pm.expect(restaurant.id).to.match(/^[a-f0-9]{24}$/);",
                  "});",
                  "",
                  "// Set collection variables using both methods for compatibility",
                  "pm.collectionVariables.set('restaurantId', restaurant.id);",
                  "pm.variables.set('restaurantId', restaurant.id);",
                  "",
                  "if (restaurant.spaces && restaurant.spaces.length > 0) {",
                  "    var space = restaurant.spaces[0];",
                  "    pm.collectionVariables.set('spaceId', space.id);",
                  "    pm.collectionVariables.set('maxCapacity', space.maxCapacity.toString());",
                  "    pm.collectionVariables.set('minCapacity', (space.minCapacity || 1).toString());",
                  "    pm.variables.set('spaceId', space.id);",
                  "    pm.variables.set('maxCapacity', space.maxCapacity.toString());",
                  "}",
                  "",
                  "// Calculate test date (skip Sunday which is day 0)",
                  "var d = new Date();",
                  "d.setDate(d.getDate() + 2);",
                  "// Skip Sunday (0) and Monday (1) - based on data these might be closed",
                  "while (d.getDay() === 0 || d.getDay() === 1) {",
                  "    d.setDate(d.getDate() + 1);",
                  "}",
                  "pm.collectionVariables.set('testDate', d.toISOString().split('T')[0]);",
                  "pm.variables.set('testDate', d.toISOString().split('T')[0]);",
                  "",
                  "// Calculate a second test date (different day)",
                  "var d2 = new Date();",
                  "d2.setDate(d2.getDate() + 5);",
                  "while (d2.getDay() === 0 || d2.getDay() === 1) {",
                  "    d2.setDate(d2.getDate() + 1);",
                  "}",
                  "pm.collectionVariables.set('testDate2', d2.toISOString().split('T')[0]);",
                  "",
                  "// Verify variables were set",
                  "pm.test('Variables set successfully', function() {",
                  "    var rid = pm.collectionVariables.get('restaurantId');",
                  "    pm.expect(rid).to.exist;",
                  "    pm.expect(rid).to.not.be.empty;",
                  "    console.log('Verified restaurantId:', rid);",
                  "});",
                  "",
                  "console.log('Set restaurantId:', restaurant.id);",
                  "console.log('Set spaceId:', pm.collectionVariables.get('spaceId'));",
                  "console.log('Set testDate:', pm.collectionVariables.get('testDate'));",
                  "console.log('Set testDate2:', pm.collectionVariables.get('testDate2'));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/restaurants?page=0&size=1",
              "host": ["{{baseUrl}}"],
              "path": ["restaurants"],
              "query": [
                {"key": "page", "value": "0"},
                {"key": "size", "value": "1"}
              ]
            }
          }
        },
        {
          "name": "1.3 Get Restaurant Details",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// Check if restaurantId is set from test 1.2",
                  "var restaurantId = pm.collectionVariables.get('restaurantId');",
                  "if (!restaurantId) {",
                  "    console.warn('WARNING: restaurantId not set! Test 1.2 must run first.');",
                  "    console.warn('Please run the collection using Collection Runner to ensure correct sequence.');",
                  "}"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Skip tests if restaurantId wasn't set (run order issue)",
                  "var restaurantId = pm.collectionVariables.get('restaurantId');",
                  "if (!restaurantId) {",
                  "    pm.test('SKIPPED - restaurantId not set (run collection in sequence)', function() {",
                  "        pm.expect.fail('Run test 1.2 first or use Collection Runner');",
                  "    });",
                  "    return;",
                  "}",
                  "",
                  "pm.test('Restaurant retrieved successfully', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var data = pm.response.json();",
                  "",
                  "pm.test('Restaurant has required fields', function() {",
                  "    pm.expect(data.id).to.exist;",
                  "    pm.expect(data.name).to.exist;",
                  "    pm.expect(data.spaces).to.be.an('array');",
                  "});",
                  "",
                  "pm.test('Restaurant ID matches requested', function() {",
                  "    pm.expect(data.id).to.eql(pm.collectionVariables.get('restaurantId'));",
                  "});",
                  "",
                  "// Note: Operating hours are not exposed in the API response DTO.",
                  "// Using default operating hours for validation tests.",
                  "pm.collectionVariables.set('openTime', '09:00');",
                  "pm.collectionVariables.set('closeTime', '22:00');",
                  "console.log('Using default operating hours: 09:00 - 22:00');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/restaurants/{{restaurantId}}",
              "host": ["{{baseUrl}}"],
              "path": ["restaurants", "{{restaurantId}}"]
            }
          }
        },
        {
          "name": "1.4 List Spaces by Restaurant",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// Check if restaurantId is set",
                  "var restaurantId = pm.collectionVariables.get('restaurantId');",
                  "if (!restaurantId) {",
                  "    console.warn('WARNING: restaurantId not set! Test 1.2 must run first.');",
                  "}"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Skip tests if restaurantId wasn't set",
                  "var restaurantId = pm.collectionVariables.get('restaurantId');",
                  "if (!restaurantId) {",
                  "    pm.test('SKIPPED - restaurantId not set (run collection in sequence)', function() {",
                  "        pm.expect.fail('Run test 1.2 first or use Collection Runner');",
                  "    });",
                  "    return;",
                  "}",
                  "",
                  "pm.test('Spaces list retrieved successfully', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var data = pm.response.json();",
                  "",
                  "pm.test('Response is an array of spaces', function() {",
                  "    pm.expect(data).to.be.an('array');",
                  "    pm.expect(data.length).to.be.greaterThan(0);",
                  "});",
                  "",
                  "var space = data[0];",
                  "",
                  "pm.test('Space has required fields', function() {",
                  "    pm.expect(space.id).to.exist;",
                  "    pm.expect(space.name).to.exist;",
                  "    pm.expect(space.maxCapacity).to.exist;",
                  "    pm.expect(space.minCapacity).to.exist;",
                  "});",
                  "",
                  "// Update space variables",
                  "pm.collectionVariables.set('spaceId', space.id);",
                  "pm.collectionVariables.set('maxCapacity', space.maxCapacity.toString());",
                  "pm.collectionVariables.set('minCapacity', space.minCapacity.toString());",
                  "console.log('Using space:', space.name, 'with capacity:', space.minCapacity, '-', space.maxCapacity);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/restaurants/{{restaurantId}}/spaces",
              "host": ["{{baseUrl}}"],
              "path": ["restaurants", "{{restaurantId}}", "spaces"]
            }
          }
        },
        {
          "name": "1.5 Get Availability & Find Slot",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Availability retrieved', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var data = pm.response.json();",
                  "",
                  "pm.test('AvailabilityResponse structure is valid', function() {",
                  "    // Per AvailabilityResponse.java",
                  "    pm.expect(data.spaceId).to.exist;",
                  "    pm.expect(data.spaceName).to.exist;",
                  "    pm.expect(data.maxCapacity).to.exist;",
                  "    pm.expect(data.date).to.exist;",
                  "    pm.expect(data.timeSlots).to.be.an('array');",
                  "    pm.expect(data.isOpen).to.exist;",
                  "});",
                  "",
                  "// Check if restaurant is open on this day",
                  "pm.test('Restaurant is open on test date', function() {",
                  "    pm.expect(data.isOpen).to.be.true;",
                  "    if (!data.isOpen) {",
                  "        console.error('Restaurant is CLOSED on ' + pm.collectionVariables.get('testDate'));",
                  "        console.error('Try running with a different testDate (Tue-Sat work best)');",
                  "    }",
                  "});",
                  "",
                  "pm.test('TimeSlotResponse structure is valid', function() {",
                  "    // Per TimeSlotResponse.java",
                  "    if (data.timeSlots.length > 0) {",
                  "        var slot = data.timeSlots[0];",
                  "        pm.expect(slot.startTime).to.exist;",
                  "        pm.expect(slot.endTime).to.exist;",
                  "        pm.expect(slot.availableCapacity).to.exist;",
                  "        pm.expect(slot.bookedCapacity).to.exist;",
                  "        pm.expect(slot.status).to.exist;",
                  "        pm.expect(slot.existingReservations).to.exist;",
                  "    }",
                  "});",
                  "",
                  "// Find an available slot with enough capacity for multiple bookings",
                  "// Need at least 8 capacity for Section 6 tests (two bookings of 4)",
                  "var availableSlot = data.timeSlots.find(s => s.status === 'AVAILABLE' && s.availableCapacity >= 8);",
                  "if (!availableSlot) {",
                  "    availableSlot = data.timeSlots.find(s => s.status === 'AVAILABLE');",
                  "}",
                  "if (!availableSlot) {",
                  "    availableSlot = data.timeSlots.find(s => s.status === 'LIMITED' && s.availableCapacity >= 4);",
                  "}",
                  "",
                  "pm.test('At least one bookable slot exists', function() {",
                  "    if (data.isOpen) {",
                  "        pm.expect(availableSlot).to.exist;",
                  "    }",
                  "});",
                  "",
                  "if (availableSlot) {",
                  "    pm.collectionVariables.set('availableStartTime', availableSlot.startTime);",
                  "    pm.collectionVariables.set('availableEndTime', availableSlot.endTime);",
                  "    pm.variables.set('availableStartTime', availableSlot.startTime);",
                  "    console.log('Found bookable slot:', availableSlot.startTime, '-', availableSlot.endTime, 'with capacity:', availableSlot.availableCapacity);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/availability/spaces/{{spaceId}}?date={{testDate}}",
              "host": ["{{baseUrl}}"],
              "path": ["availability", "spaces", "{{spaceId}}"],
              "query": [{"key": "date", "value": "{{testDate}}"}]
            }
          }
        }
      ]
    },
    {
      "name": "2. Happy Path - Reservation Lifecycle",
      "item": [
        {
          "name": "2.1 Create Reservation",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// Debug logging",
                  "console.log('Creating reservation with:');",
                  "console.log('  spaceId:', pm.collectionVariables.get('spaceId'));",
                  "console.log('  testDate:', pm.collectionVariables.get('testDate'));",
                  "console.log('  availableStartTime:', pm.collectionVariables.get('availableStartTime'));",
                  "",
                  "// Verify required variables are set",
                  "if (!pm.collectionVariables.get('spaceId')) {",
                  "    console.error('ERROR: spaceId not set - run Section 1 first');",
                  "}",
                  "if (!pm.collectionVariables.get('testDate')) {",
                  "    console.error('ERROR: testDate not set - run Section 1 first');",
                  "}",
                  "if (!pm.collectionVariables.get('availableStartTime')) {",
                  "    console.error('ERROR: availableStartTime not set - run test 1.5 first');",
                  "}"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Log response for debugging",
                  "if (pm.response.code !== 201) {",
                  "    console.error('Reservation failed with status:', pm.response.code);",
                  "    console.error('Response:', pm.response.text());",
                  "}",
                  "",
                  "pm.test('Reservation created', function() {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "var data = pm.response.json();",
                  "",
                  "pm.test('ReservationResponse has all required fields', function() {",
                  "    // Per ReservationResponse.java",
                  "    pm.expect(data.id).to.exist;",
                  "    pm.expect(data.spaceId).to.exist;",
                  "    pm.expect(data.spaceName).to.exist;",
                  "    pm.expect(data.restaurantId).to.exist;",
                  "    pm.expect(data.restaurantName).to.exist;",
                  "    pm.expect(data.reservationDate).to.exist;",
                  "    pm.expect(data.startTime).to.exist;",
                  "    pm.expect(data.endTime).to.exist;",
                  "    pm.expect(data.partySize).to.exist;",
                  "    pm.expect(data.customerName).to.exist;",
                  "    pm.expect(data.customerEmail).to.exist;",
                  "    pm.expect(data.status).to.exist;",
                  "});",
                  "",
                  "pm.test('Status is CONFIRMED', function() {",
                  "    pm.expect(data.status).to.eql('CONFIRMED');",
                  "});",
                  "",
                  "pm.test('Has correct space (UUID comparison)', function() {",
                  "    // spaceId is a UUID in ReservationResponse",
                  "    pm.expect(data.spaceId.toString()).to.eql(pm.collectionVariables.get('spaceId'));",
                  "});",
                  "",
                  "pm.test('Party size matches request', function() {",
                  "    pm.expect(data.partySize).to.eql(4);",
                  "});",
                  "",
                  "if (data.id) {",
                  "    pm.collectionVariables.set('reservationId', data.id);",
                  "    pm.variables.set('reservationId', data.id);",
                  "    console.log('Created reservation:', data.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"spaceId\": \"{{spaceId}}\",\n  \"reservationDate\": \"{{testDate}}\",\n  \"startTime\": \"{{availableStartTime}}\",\n  \"partySize\": 4,\n  \"customerName\": \"John Smith\",\n  \"customerEmail\": \"john.{{$timestamp}}@test.com\",\n  \"customerPhone\": \"+1-555-1234\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/reservations",
              "host": ["{{baseUrl}}"],
              "path": ["reservations"]
            }
          }
        },
        {
          "name": "2.2 Get Reservation by ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Reservation retrieved', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var data = pm.response.json();",
                  "",
                  "pm.test('ReservationResponse structure is valid', function() {",
                  "    // Per ReservationResponse.java",
                  "    pm.expect(data.id).to.exist;",
                  "    pm.expect(data.spaceId).to.exist;",
                  "    pm.expect(data.spaceName).to.exist;",
                  "    pm.expect(data.restaurantId).to.exist;",
                  "    pm.expect(data.restaurantName).to.exist;",
                  "    pm.expect(data.reservationDate).to.exist;",
                  "    pm.expect(data.startTime).to.exist;",
                  "    pm.expect(data.endTime).to.exist;",
                  "    pm.expect(data.partySize).to.exist;",
                  "    pm.expect(data.status).to.exist;",
                  "});",
                  "",
                  "pm.test('Correct reservation ID', function() {",
                  "    pm.expect(data.id).to.eql(pm.collectionVariables.get('reservationId'));",
                  "});",
                  "",
                  "pm.test('Status is CONFIRMED', function() {",
                  "    pm.expect(data.status).to.eql('CONFIRMED');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/reservations/{{reservationId}}",
              "host": ["{{baseUrl}}"],
              "path": ["reservations", "{{reservationId}}"]
            }
          }
        },
        {
          "name": "2.3 Verify Capacity Reduced",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Availability retrieved', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var data = pm.response.json();",
                  "var startTime = pm.collectionVariables.get('availableStartTime');",
                  "",
                  "var slot = data.timeSlots.find(s => s.startTime === startTime);",
                  "",
                  "pm.test('Slot found', function() {",
                  "    pm.expect(slot).to.exist;",
                  "});",
                  "",
                  "// Store capacity before our reservation for later comparison",
                  "// Note: capacity = maxCapacity - existing bookings - our new booking (4)",
                  "pm.collectionVariables.set('capacityAfterBooking', slot.availableCapacity.toString());",
                  "console.log('Capacity after booking:', slot.availableCapacity);",
                  "",
                  "pm.test('Capacity includes our booking of 4', function() {",
                  "    // Our booking of 4 should be reflected in bookedCapacity",
                  "    pm.expect(slot.bookedCapacity).to.be.at.least(4);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/availability/spaces/{{spaceId}}?date={{testDate}}",
              "host": ["{{baseUrl}}"],
              "path": ["availability", "spaces", "{{spaceId}}"],
              "query": [{"key": "date", "value": "{{testDate}}"}]
            }
          }
        },
        {
          "name": "2.4 Cancel Reservation",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Cancellation successful', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var data = pm.response.json();",
                  "",
                  "pm.test('CancellationResponse structure is valid', function() {",
                  "    // Per CancellationResponse.java",
                  "    pm.expect(data.reservationId).to.exist;",
                  "    pm.expect(data.message).to.exist;",
                  "    pm.expect(data.cancelledAt).to.exist;",
                  "});",
                  "",
                  "pm.test('Has cancellation message', function() {",
                  "    pm.expect(data.message.toLowerCase()).to.include('cancelled');",
                  "});",
                  "",
                  "pm.test('Cancellation reason is recorded', function() {",
                  "    pm.expect(data.cancellationReason).to.eql('Test cancellation');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\"reason\": \"Test cancellation\"}"
            },
            "url": {
              "raw": "{{baseUrl}}/reservations/{{reservationId}}/cancel",
              "host": ["{{baseUrl}}"],
              "path": ["reservations", "{{reservationId}}", "cancel"]
            }
          }
        },
        {
          "name": "2.5 Verify Capacity Restored",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Availability retrieved', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var data = pm.response.json();",
                  "var startTime = pm.collectionVariables.get('availableStartTime');",
                  "var capacityAfterBooking = parseInt(pm.collectionVariables.get('capacityAfterBooking'));",
                  "",
                  "var slot = data.timeSlots.find(s => s.startTime === startTime);",
                  "",
                  "pm.test('Capacity restored after cancellation', function() {",
                  "    // After cancelling our booking of 4, capacity should increase by 4",
                  "    pm.expect(slot.availableCapacity).to.eql(capacityAfterBooking + 4);",
                  "    console.log('Capacity restored to:', slot.availableCapacity, '(was', capacityAfterBooking, ')');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/availability/spaces/{{spaceId}}?date={{testDate}}",
              "host": ["{{baseUrl}}"],
              "path": ["availability", "spaces", "{{spaceId}}"],
              "query": [{"key": "date", "value": "{{testDate}}"}]
            }
          }
        }
      ]
    },
    {
      "name": "3. Validation Tests",
      "item": [
        {
          "name": "3.1 Reject - Before Opening (06:00)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Rejected with 400', function() {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test('Error is OUTSIDE_OPERATING_HOURS', function() {",
                  "    pm.expect(pm.response.json().error).to.eql('OUTSIDE_OPERATING_HOURS');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"spaceId\": \"{{spaceId}}\",\n  \"reservationDate\": \"{{testDate}}\",\n  \"startTime\": \"06:00\",\n  \"partySize\": 4,\n  \"customerName\": \"Test\",\n  \"customerEmail\": \"test@test.com\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/reservations",
              "host": ["{{baseUrl}}"],
              "path": ["reservations"]
            }
          }
        },
        {
          "name": "3.2.1 Reject - End Time Crosses Midnight (23:00)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Rejected with 400', function() {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test('Error is OUTSIDE_OPERATING_HOURS', function() {",
                  "    pm.expect(pm.response.json().error).to.eql('OUTSIDE_OPERATING_HOURS');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"spaceId\": \"{{spaceId}}\",\n  \"reservationDate\": \"{{testDate}}\",\n  \"startTime\": \"23:00\",\n  \"partySize\": 4,\n  \"customerName\": \"Test\",\n  \"customerEmail\": \"test@test.com\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/reservations",
              "host": ["{{baseUrl}}"],
              "path": ["reservations"]
            }
          }
        },
        {
          "name": "3.2.2 Reject - Early Morning (00:30)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Rejected with 400', function() {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test('Error is OUTSIDE_OPERATING_HOURS', function() {",
                  "    pm.expect(pm.response.json().error).to.eql('OUTSIDE_OPERATING_HOURS');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"spaceId\": \"{{spaceId}}\",\n  \"reservationDate\": \"{{testDate}}\",\n  \"startTime\": \"00:30\",\n  \"partySize\": 4,\n  \"customerName\": \"Test\",\n  \"customerEmail\": \"test@test.com\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/reservations",
              "host": ["{{baseUrl}}"],
              "path": ["reservations"]
            }
          }
        },
        {
          "name": "3.3 Reject - Invalid Time Slot (18:47)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Rejected with 400', function() {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test('Error is INVALID_TIME_SLOT', function() {",
                  "    pm.expect(pm.response.json().error).to.eql('INVALID_TIME_SLOT');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"spaceId\": \"{{spaceId}}\",\n  \"reservationDate\": \"{{testDate}}\",\n  \"startTime\": \"18:47\",\n  \"partySize\": 4,\n  \"customerName\": \"Test\",\n  \"customerEmail\": \"test@test.com\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/reservations",
              "host": ["{{baseUrl}}"],
              "path": ["reservations"]
            }
          }
        },
        {
          "name": "3.4.1 Reject - Party Size Exceeds Space Max",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// Get maxCapacity and add 1 to exceed it (but stay under 100 for request validation)",
                  "var maxCap = parseInt(pm.collectionVariables.get('maxCapacity')) || 20;",
                  "pm.variables.set('exceedingPartySize', Math.min(maxCap + 1, 99));"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Rejected with 400 Bad Request', function() {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test('Error code is INVALID_PARTY_SIZE', function() {",
                  "    pm.expect(pm.response.json().error).to.eql('INVALID_PARTY_SIZE');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"spaceId\": \"{{spaceId}}\",\n  \"reservationDate\": \"{{testDate}}\",\n  \"startTime\": \"{{availableStartTime}}\",\n  \"partySize\": {{exceedingPartySize}},\n  \"customerName\": \"Test\",\n  \"customerEmail\": \"test@test.com\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/reservations",
              "host": ["{{baseUrl}}"],
              "path": ["reservations"]
            }
          }
        },
        {
          "name": "3.4.2 Reject - Party Size Over 100 (Request Validation)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Rejected with 400 Bad Request', function() {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test('Error code is INVALID_PARTY_SIZE', function() {",
                  "    // Party size > 100 triggers @Max validation which maps to INVALID_PARTY_SIZE",
                  "    pm.expect(pm.response.json().error).to.eql('INVALID_PARTY_SIZE');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"spaceId\": \"{{spaceId}}\",\n  \"reservationDate\": \"{{testDate}}\",\n  \"startTime\": \"{{availableStartTime}}\",\n  \"partySize\": 999,\n  \"customerName\": \"Test\",\n  \"customerEmail\": \"test@test.com\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/reservations",
              "host": ["{{baseUrl}}"],
              "path": ["reservations"]
            }
          }
        },
        {
          "name": "3.5 Reject - Party Size Zero",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Rejected with 400', function() {",
                  "    pm.response.to.have.status(400);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"spaceId\": \"{{spaceId}}\",\n  \"reservationDate\": \"{{testDate}}\",\n  \"startTime\": \"{{availableStartTime}}\",\n  \"partySize\": 0,\n  \"customerName\": \"Test\",\n  \"customerEmail\": \"test@test.com\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/reservations",
              "host": ["{{baseUrl}}"],
              "path": ["reservations"]
            }
          }
        },
        {
          "name": "3.6 Reject - Past Date",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Rejected with 400', function() {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test('Error is PAST_DATE', function() {",
                  "    pm.expect(pm.response.json().error).to.eql('PAST_DATE');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"spaceId\": \"{{spaceId}}\",\n  \"reservationDate\": \"2020-01-01\",\n  \"startTime\": \"18:00\",\n  \"partySize\": 4,\n  \"customerName\": \"Test\",\n  \"customerEmail\": \"test@test.com\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/reservations",
              "host": ["{{baseUrl}}"],
              "path": ["reservations"]
            }
          }
        },
        {
          "name": "3.7 Reject - Beyond 90 Days",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "var d = new Date();",
                  "d.setDate(d.getDate() + 91);",
                  "pm.variables.set('farDate', d.toISOString().split('T')[0]);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Rejected with 400', function() {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test('Error is ADVANCE_BOOKING_LIMIT_EXCEEDED', function() {",
                  "    pm.expect(pm.response.json().error).to.eql('ADVANCE_BOOKING_LIMIT_EXCEEDED');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"spaceId\": \"{{spaceId}}\",\n  \"reservationDate\": \"{{farDate}}\",\n  \"startTime\": \"18:00\",\n  \"partySize\": 4,\n  \"customerName\": \"Test\",\n  \"customerEmail\": \"test@test.com\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/reservations",
              "host": ["{{baseUrl}}"],
              "path": ["reservations"]
            }
          }
        },
        {
          "name": "3.8 Reject - Missing Required Fields",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Rejected with 400', function() {",
                  "    pm.response.to.have.status(400);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"spaceId\": \"{{spaceId}}\",\n  \"reservationDate\": \"{{testDate}}\",\n  \"startTime\": \"18:00\",\n  \"partySize\": 4\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/reservations",
              "host": ["{{baseUrl}}"],
              "path": ["reservations"]
            }
          }
        },
        {
          "name": "3.9 Reject - Invalid Email Format",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Rejected with 400', function() {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test('Error is INVALID_EMAIL', function() {",
                  "    pm.expect(pm.response.json().error).to.eql('INVALID_EMAIL');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"spaceId\": \"{{spaceId}}\",\n  \"reservationDate\": \"{{testDate}}\",\n  \"startTime\": \"18:00\",\n  \"partySize\": 4,\n  \"customerName\": \"Test\",\n  \"customerEmail\": \"not-an-email\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/reservations",
              "host": ["{{baseUrl}}"],
              "path": ["reservations"]
            }
          }
        },
        {
          "name": "3.10 Reject - Non-Existent Space",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Rejected with 404', function() {",
                  "    pm.response.to.have.status(404);",
                  "});",
                  "",
                  "pm.test('Error is SPACE_NOT_FOUND', function() {",
                  "    pm.expect(pm.response.json().error).to.eql('SPACE_NOT_FOUND');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"spaceId\": \"00000000-0000-0000-0000-000000000000\",\n  \"reservationDate\": \"{{testDate}}\",\n  \"startTime\": \"18:00\",\n  \"partySize\": 4,\n  \"customerName\": \"Test\",\n  \"customerEmail\": \"test@test.com\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/reservations",
              "host": ["{{baseUrl}}"],
              "path": ["reservations"]
            }
          }
        },
        {
          "name": "3.11 Reject - Non-Existent Reservation",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Rejected with 404', function() {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/reservations/000000000000000000000000",
              "host": ["{{baseUrl}}"],
              "path": ["reservations", "000000000000000000000000"]
            }
          }
        },
        {
          "name": "3.12 Reject - Cancel Already Cancelled",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Rejected with 400', function() {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test('Error is ALREADY_CANCELLED', function() {",
                  "    // API returns ALREADY_CANCELLED for already cancelled reservations",
                  "    pm.expect(pm.response.json().error).to.eql('ALREADY_CANCELLED');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\"reason\": \"Test\"}"
            },
            "url": {
              "raw": "{{baseUrl}}/reservations/{{reservationId}}/cancel",
              "host": ["{{baseUrl}}"],
              "path": ["reservations", "{{reservationId}}", "cancel"]
            }
          }
        }
      ]
    },
    {
      "name": "4. Reporting",
      "item": [
        {
          "name": "4.1 Occupancy Report - Daily",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "var end = new Date();",
                  "var start = new Date();",
                  "start.setDate(start.getDate() - 30);",
                  "pm.variables.set('startDate', start.toISOString().split('T')[0]);",
                  "pm.variables.set('endDate', end.toISOString().split('T')[0]);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Report generated successfully', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var data = pm.response.json();",
                  "",
                  "pm.test('OccupancyReportResponse structure is valid', function() {",
                  "    // Per OccupancyReportResponse.java",
                  "    pm.expect(data.restaurantId).to.exist;",
                  "    pm.expect(data.restaurantName).to.exist;",
                  "    pm.expect(data.period).to.exist;",
                  "    pm.expect(data.summary).to.exist;",
                  "});",
                  "",
                  "pm.test('Report period has dates', function() {",
                  "    pm.expect(data.period.startDate).to.exist;",
                  "    pm.expect(data.period.endDate).to.exist;",
                  "});",
                  "",
                  "pm.test('Summary has metrics', function() {",
                  "    pm.expect(data.summary.totalReservations).to.exist;",
                  "    pm.expect(data.summary.totalGuests).to.exist;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/reports/occupancy?restaurantId={{restaurantId}}&startDate={{startDate}}&endDate={{endDate}}&granularity=DAILY",
              "host": ["{{baseUrl}}"],
              "path": ["reports", "occupancy"],
              "query": [
                {"key": "restaurantId", "value": "{{restaurantId}}"},
                {"key": "startDate", "value": "{{startDate}}"},
                {"key": "endDate", "value": "{{endDate}}"},
                {"key": "granularity", "value": "DAILY"}
              ]
            }
          }
        },
        {
          "name": "4.2 Occupancy Report - Hourly",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "var end = new Date();",
                  "var start = new Date();",
                  "start.setDate(start.getDate() - 7);",
                  "pm.variables.set('startDate', start.toISOString().split('T')[0]);",
                  "pm.variables.set('endDate', end.toISOString().split('T')[0]);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Report generated successfully', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var data = pm.response.json();",
                  "",
                  "pm.test('Report has valid structure for hourly request', function() {",
                  "    // OccupancyReportResponse structure - no granularity field exposed",
                  "    pm.expect(data.restaurantId).to.exist;",
                  "    pm.expect(data.period).to.exist;",
                  "    pm.expect(data.summary).to.exist;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/reports/occupancy?restaurantId={{restaurantId}}&startDate={{startDate}}&endDate={{endDate}}&granularity=HOURLY",
              "host": ["{{baseUrl}}"],
              "path": ["reports", "occupancy"],
              "query": [
                {"key": "restaurantId", "value": "{{restaurantId}}"},
                {"key": "startDate", "value": "{{startDate}}"},
                {"key": "endDate", "value": "{{endDate}}"},
                {"key": "granularity", "value": "HOURLY"}
              ]
            }
          }
        },
        {
          "name": "4.3 Occupancy Report - With Space Filter",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "var end = new Date();",
                  "var start = new Date();",
                  "start.setDate(start.getDate() - 14);",
                  "pm.variables.set('startDate', start.toISOString().split('T')[0]);",
                  "pm.variables.set('endDate', end.toISOString().split('T')[0]);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Report generated successfully', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var data = pm.response.json();",
                  "",
                  "pm.test('Report filtered by space', function() {",
                  "    // When filtered by space, should only contain that space's data",
                  "    pm.expect(data.restaurantId).to.exist;",
                  "    pm.expect(data.summary).to.exist;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/reports/occupancy?restaurantId={{restaurantId}}&startDate={{startDate}}&endDate={{endDate}}&granularity=DAILY&spaceId={{spaceId}}",
              "host": ["{{baseUrl}}"],
              "path": ["reports", "occupancy"],
              "query": [
                {"key": "restaurantId", "value": "{{restaurantId}}"},
                {"key": "startDate", "value": "{{startDate}}"},
                {"key": "endDate", "value": "{{endDate}}"},
                {"key": "granularity", "value": "DAILY"},
                {"key": "spaceId", "value": "{{spaceId}}"}
              ]
            }
          }
        },
        {
          "name": "4.4 Reject - Non-Existent Restaurant",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "var end = new Date();",
                  "var start = new Date();",
                  "start.setDate(start.getDate() - 7);",
                  "pm.variables.set('startDate', start.toISOString().split('T')[0]);",
                  "pm.variables.set('endDate', end.toISOString().split('T')[0]);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Rejected with 404', function() {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/reports/occupancy?restaurantId=000000000000000000000000&startDate={{startDate}}&endDate={{endDate}}&granularity=DAILY",
              "host": ["{{baseUrl}}"],
              "path": ["reports", "occupancy"],
              "query": [
                {"key": "restaurantId", "value": "000000000000000000000000"},
                {"key": "startDate", "value": "{{startDate}}"},
                {"key": "endDate", "value": "{{endDate}}"},
                {"key": "granularity", "value": "DAILY"}
              ]
            }
          }
        }
      ]
    },
    {
      "name": "5. Restaurant API",
      "item": [
        {
          "name": "5.1 List All Restaurants",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var data = pm.response.json();",
                  "",
                  "pm.test('PageResponse structure is valid', function() {",
                  "    // Per PageResponse.java",
                  "    pm.expect(data.content).to.be.an('array');",
                  "    pm.expect(data.totalElements).to.exist;",
                  "    pm.expect(data.totalPages).to.exist;",
                  "    pm.expect(data.size).to.exist;",
                  "    pm.expect(data.page).to.exist;",
                  "});",
                  "",
                  "pm.test('RestaurantDTO structure is valid', function() {",
                  "    // Per RestaurantDTO.java",
                  "    if (data.content.length > 0) {",
                  "        var restaurant = data.content[0];",
                  "        pm.expect(restaurant.id).to.exist;",
                  "        pm.expect(restaurant.name).to.exist;",
                  "        pm.expect(restaurant.spaces).to.be.an('array');",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/restaurants?page=0&size=10",
              "host": ["{{baseUrl}}"],
              "path": ["restaurants"],
              "query": [
                {"key": "page", "value": "0"},
                {"key": "size", "value": "10"}
              ]
            }
          }
        },
        {
          "name": "5.2 Get Single Restaurant",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var data = pm.response.json();",
                  "",
                  "pm.test('RestaurantDTO structure is valid', function() {",
                  "    // Per RestaurantDTO.java",
                  "    pm.expect(data.id).to.exist;",
                  "    pm.expect(data.name).to.exist;",
                  "    pm.expect(data.spaces).to.be.an('array');",
                  "});",
                  "",
                  "pm.test('SpaceDTO structure in spaces array', function() {",
                  "    // Per SpaceDTO.java",
                  "    if (data.spaces.length > 0) {",
                  "        var space = data.spaces[0];",
                  "        pm.expect(space.id).to.exist;",
                  "        pm.expect(space.name).to.exist;",
                  "        pm.expect(space.minCapacity).to.exist;",
                  "        pm.expect(space.maxCapacity).to.exist;",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/restaurants/{{restaurantId}}",
              "host": ["{{baseUrl}}"],
              "path": ["restaurants", "{{restaurantId}}"]
            }
          }
        },
        {
          "name": "5.3 Get Restaurant Spaces",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var data = pm.response.json();",
                  "",
                  "pm.test('Response is array of SpaceDTO', function() {",
                  "    pm.expect(data).to.be.an('array');",
                  "});",
                  "",
                  "pm.test('SpaceDTO structure is valid', function() {",
                  "    // Per SpaceDTO.java",
                  "    if (data.length > 0) {",
                  "        var space = data[0];",
                  "        pm.expect(space.id).to.exist;",
                  "        pm.expect(space.name).to.exist;",
                  "        pm.expect(space.minCapacity).to.exist;",
                  "        pm.expect(space.maxCapacity).to.exist;",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/restaurants/{{restaurantId}}/spaces",
              "host": ["{{baseUrl}}"],
              "path": ["restaurants", "{{restaurantId}}", "spaces"]
            }
          }
        },
        {
          "name": "5.4 Get Non-Existent Restaurant",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Returns 404', function() {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/restaurants/000000000000000000000000",
              "host": ["{{baseUrl}}"],
              "path": ["restaurants", "000000000000000000000000"]
            }
          }
        }
      ]
    },
    {
      "name": "6. Advanced Reservation Scenarios",
      "item": [
        {
          "name": "6.1 List All Reservations (Paginated)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var data = pm.response.json();",
                  "",
                  "pm.test('PageResponse structure is valid', function() {",
                  "    pm.expect(data.content).to.be.an('array');",
                  "    pm.expect(data.totalElements).to.exist;",
                  "    pm.expect(data.totalPages).to.exist;",
                  "    pm.expect(data.size).to.exist;",
                  "    pm.expect(data.page).to.exist;",
                  "});",
                  "",
                  "pm.test('ReservationDTO structure is valid', function() {",
                  "    // ReservationDTO uses startTime (LocalDateTime), not reservationDate",
                  "    if (data.content.length > 0) {",
                  "        var reservation = data.content[0];",
                  "        pm.expect(reservation.id).to.exist;",
                  "        pm.expect(reservation.spaceId).to.exist;",
                  "        pm.expect(reservation.startTime).to.exist;",
                  "        pm.expect(reservation.status).to.exist;",
                  "    }",
                  "});",
                  "",
                  "console.log('Total reservations:', data.totalElements);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/reservations?page=0&size=10&sortBy=reservationDate&sortDir=desc",
              "host": ["{{baseUrl}}"],
              "path": ["reservations"],
              "query": [
                {"key": "page", "value": "0"},
                {"key": "size", "value": "10"},
                {"key": "sortBy", "value": "reservationDate"},
                {"key": "sortDir", "value": "desc"}
              ]
            }
          }
        },
        {
          "name": "6.2 Setup - Get Fresh Availability for testDate2",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Availability retrieved', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var data = pm.response.json();",
                  "",
                  "// Find an available slot with enough capacity for multiple bookings",
                  "var availableSlot = data.timeSlots.find(s => s.status === 'AVAILABLE' && s.availableCapacity >= 10);",
                  "if (!availableSlot) {",
                  "    availableSlot = data.timeSlots.find(s => s.status === 'AVAILABLE');",
                  "}",
                  "",
                  "pm.test('Found slot with sufficient capacity', function() {",
                  "    pm.expect(availableSlot).to.exist;",
                  "    pm.expect(availableSlot.availableCapacity).to.be.at.least(8);",
                  "});",
                  "",
                  "if (availableSlot) {",
                  "    // Set both start and end time for the slot",
                  "    pm.collectionVariables.set('availableStartTime', availableSlot.startTime);",
                  "    pm.collectionVariables.set('availableEndTime', availableSlot.endTime);",
                  "    console.log('6.2 - Set availableStartTime:', availableSlot.startTime);",
                  "    console.log('6.2 - Set availableEndTime:', availableSlot.endTime);",
                  "    console.log('6.2 - Slot capacity:', availableSlot.availableCapacity);",
                  "} else {",
                  "    console.error('6.2 - No available slot found!');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/availability/spaces/{{spaceId}}?date={{testDate2}}",
              "host": ["{{baseUrl}}"],
              "path": ["availability", "spaces", "{{spaceId}}"],
              "query": [{"key": "date", "value": "{{testDate2}}"}]
            }
          }
        },
        {
          "name": "6.3 Create First Booking in Slot",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('First reservation created', function() {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "var data = pm.response.json();",
                  "",
                  "pm.test('Status is CONFIRMED', function() {",
                  "    pm.expect(data.status).to.eql('CONFIRMED');",
                  "});",
                  "",
                  "// Store the actual startTime from the response for later comparison",
                  "pm.collectionVariables.set('firstBookingStartTime', data.startTime);",
                  "pm.collectionVariables.set('reservationId2', data.id);",
                  "console.log('6.3 - Created first reservation:', data.id);",
                  "console.log('6.3 - Response startTime:', data.startTime);",
                  "console.log('6.3 - Expected startTime:', pm.collectionVariables.get('availableStartTime'));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"spaceId\": \"{{spaceId}}\",\n  \"reservationDate\": \"{{testDate2}}\",\n  \"startTime\": \"{{availableStartTime}}\",\n  \"partySize\": 4,\n  \"customerName\": \"Alice Johnson\",\n  \"customerEmail\": \"alice.{{$timestamp}}@test.com\",\n  \"customerPhone\": \"+1-555-2001\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/reservations",
              "host": ["{{baseUrl}}"],
              "path": ["reservations"]
            }
          }
        },
        {
          "name": "6.4 Create Second Booking in SAME Slot (Flexible Capacity)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Second reservation in same slot created', function() {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "var data = pm.response.json();",
                  "",
                  "pm.test('Status is CONFIRMED', function() {",
                  "    pm.expect(data.status).to.eql('CONFIRMED');",
                  "});",
                  "",
                  "pm.test('Same time slot as first reservation', function() {",
                  "    // Compare with the startTime from the first booking (test 6.3)",
                  "    var firstBookingTime = pm.collectionVariables.get('firstBookingStartTime');",
                  "    console.log('6.4 - Second reservation startTime:', data.startTime);",
                  "    console.log('6.4 - First booking startTime:', firstBookingTime);",
                  "    pm.expect(data.startTime).to.eql(firstBookingTime);",
                  "});",
                  "",
                  "pm.collectionVariables.set('reservationId3', data.id);",
                  "console.log('Created second reservation in same slot:', data.id, 'for party of 3');",
                  "console.log('Flexible capacity model verified - multiple bookings in same slot!');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"spaceId\": \"{{spaceId}}\",\n  \"reservationDate\": \"{{testDate2}}\",\n  \"startTime\": \"{{availableStartTime}}\",\n  \"partySize\": 3,\n  \"customerName\": \"Bob Williams\",\n  \"customerEmail\": \"bob.{{$timestamp}}@test.com\",\n  \"customerPhone\": \"+1-555-2002\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/reservations",
              "host": ["{{baseUrl}}"],
              "path": ["reservations"]
            }
          }
        },
        {
          "name": "6.5 Verify Combined Capacity Usage",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Availability retrieved', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var data = pm.response.json();",
                  "// Use the startTime from the first booking for consistent lookup",
                  "var startTime = pm.collectionVariables.get('firstBookingStartTime');",
                  "console.log('6.5 - Looking for slot with startTime:', startTime);",
                  "var slot = data.timeSlots.find(s => s.startTime === startTime);",
                  "",
                  "pm.test('Slot found for our reservations', function() {",
                  "    pm.expect(slot).to.exist;",
                  "    if (!slot) {",
                  "        console.log('Available slots:', data.timeSlots.map(s => s.startTime));",
                  "    } else {",
                  "        // Store the correct endTime for capacity endpoint tests",
                  "        pm.collectionVariables.set('slotEndTime', slot.endTime);",
                  "        console.log('6.5 - Slot endTime:', slot.endTime);",
                  "    }",
                  "});",
                  "",
                  "pm.test('Slot shows combined booked capacity', function() {",
                  "    if (slot) {",
                  "        // First booking: 4, Second booking: 3 = 7 total",
                  "        pm.expect(slot.bookedCapacity).to.be.at.least(7);",
                  "        console.log('Total booked capacity:', slot.bookedCapacity);",
                  "    }",
                  "});",
                  "",
                  "pm.test('Slot shows multiple existing reservations', function() {",
                  "    if (slot) {",
                  "        pm.expect(slot.existingReservations).to.be.at.least(2);",
                  "        console.log('Existing reservations in slot:', slot.existingReservations);",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/availability/spaces/{{spaceId}}?date={{testDate2}}",
              "host": ["{{baseUrl}}"],
              "path": ["availability", "spaces", "{{spaceId}}"],
              "query": [{"key": "date", "value": "{{testDate2}}"}]
            }
          }
        },
        {
          "name": "6.6 Get Slot Capacity Endpoint",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Capacity info retrieved', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var data = pm.response.json();",
                  "",
                  "pm.test('CapacityInfo structure is valid', function() {",
                  "    pm.expect(data.availableCapacity).to.exist;",
                  "    pm.expect(data.bookedCapacity).to.exist;",
                  "});",
                  "",
                  "pm.test('Booked capacity reflects our reservations', function() {",
                  "    // We booked 4 + 3 = 7 guests in this slot",
                  "    pm.expect(data.bookedCapacity).to.be.at.least(7);",
                  "});",
                  "",
                  "// Store current booked capacity for comparison after delete",
                  "pm.collectionVariables.set('bookedCapacityBeforeDelete', data.bookedCapacity.toString());",
                  "console.log('Available:', data.availableCapacity, 'Booked:', data.bookedCapacity);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/availability/spaces/{{spaceId}}/capacity?date={{testDate2}}&startTime={{firstBookingStartTime}}&endTime={{slotEndTime}}",
              "host": ["{{baseUrl}}"],
              "path": ["availability", "spaces", "{{spaceId}}", "capacity"],
              "query": [
                {"key": "date", "value": "{{testDate2}}"},
                {"key": "startTime", "value": "{{firstBookingStartTime}}"},
                {"key": "endTime", "value": "{{slotEndTime}}"}
              ]
            }
          }
        },
        {
          "name": "6.7 Delete Reservation (with capacity release)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Reservation deleted', function() {",
                  "    pm.response.to.have.status(204);",
                  "});",
                  "",
                  "console.log('Deleted reservation:', pm.collectionVariables.get('reservationId3'));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/reservations/{{reservationId3}}",
              "host": ["{{baseUrl}}"],
              "path": ["reservations", "{{reservationId3}}"]
            }
          }
        },
        {
          "name": "6.8 Verify Capacity Restored After Delete",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Capacity info retrieved', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var data = pm.response.json();",
                  "",
                  "pm.test('Capacity released after delete', function() {",
                  "    // Deleted reservation was for party of 3",
                  "    // Compare with capacity before delete to verify 3 was released",
                  "    var capacityBefore = parseInt(pm.collectionVariables.get('bookedCapacityBeforeDelete'));",
                  "    var expectedAfter = capacityBefore - 3;",
                  "    console.log('Capacity before:', capacityBefore, 'Expected after:', expectedAfter, 'Actual:', data.bookedCapacity);",
                  "    pm.expect(data.bookedCapacity).to.eql(expectedAfter);",
                  "});",
                  "",
                  "console.log('After delete - Available:', data.availableCapacity, 'Booked:', data.bookedCapacity);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/availability/spaces/{{spaceId}}/capacity?date={{testDate2}}&startTime={{firstBookingStartTime}}&endTime={{slotEndTime}}",
              "host": ["{{baseUrl}}"],
              "path": ["availability", "spaces", "{{spaceId}}", "capacity"],
              "query": [
                {"key": "date", "value": "{{testDate2}}"},
                {"key": "startTime", "value": "{{firstBookingStartTime}}"},
                {"key": "endTime", "value": "{{slotEndTime}}"}
              ]
            }
          }
        },
        {
          "name": "6.9 Cleanup - Cancel Remaining Reservation",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Cleanup cancellation successful', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "console.log('Cleaned up reservation:', pm.collectionVariables.get('reservationId2'));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\"reason\": \"Test cleanup\"}"
            },
            "url": {
              "raw": "{{baseUrl}}/reservations/{{reservationId2}}/cancel",
              "host": ["{{baseUrl}}"],
              "path": ["reservations", "{{reservationId2}}", "cancel"]
            }
          }
        },
        {
          "name": "6.10 Reject - Delete Non-Existent Reservation",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Returns 404 for non-existent reservation', function() {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/reservations/000000000000000000000000",
              "host": ["{{baseUrl}}"],
              "path": ["reservations", "000000000000000000000000"]
            }
          }
        }
      ]
    }
  ]
}
